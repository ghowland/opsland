name: Example 0 Bundle


# HTTP root for this bundle.  Allows multiple bundles to coexist on the same server.  Hostnames are not considered, all paths are global once they reach OpsLand
#NOTE: No leading / for the root.  If mounted at "/" then leave this empty
root: ""


# Git repos we want to sync
git: {}


# Put all our data cache in here, 1 file per Cache Key to make it simple and glob them all back up
cache_path: ~/.cache/opsland/example0/{key}


# Where we store data
path_format:
  login_sessions: ~/.secure/opsland/logins.json


# Running commands while waiting on shell commands is no good, so everything should be done in a deferred manner.  Scheduled or as a Job execution.  Same thing ultimately
schedule:
  period:
    mtr:
      command: /mnt/d/_OpsLand/opsland-example/opsland_example.py go
      dir: /mnt/d/_OpsLand/opsland-example/
      period: 15s
      # store: single
      store: queue
      max: 50


# Every time we write data, we have the opportunity to summarize data that is not single (ex: queue)
summary:
  # Will be found in Cache with the prefix "summary.schedule.period.mtr", but with specific things being like: `summary.schedule.period.mtr.average` and then 
  #   their summary being: `summary.schedule.period.mtr.average.max` for the max value
  schedule.period.mtr:
    # Final values will be coerced to float values.  Creates: min, max, last, average, mean, stddev, timeseries
    type: float
    # If group_by exists, we will make N results.  1 per each group found, this will append an additional string, so you need to know how to reference this
    group_by: "{index}"
    fields:
      average: [mtr, null, average]
      last: [mtr, null, last]
      best: [mtr, null, best]
      worst: [mtr, null, worst]
      loss: [mtr, null, loss]


# HTTP Routing and Rendering.  All paths overlay over the `root`
http:
  get:
    # Paths
    status:
      template: pages/generic_view.html.j2

      # Extract data from this Cache, to be used for rendering
      cache:
        schedule.period.mtr: mtr
        summary.schedule.period.mtr.average: series_avg

      page: Home
      page_group: Info
      breadcrumbs:
        - For: /else
        - The: /if
        - Win: /not

      data:
        table_dict:
          # Payload output key
          table_data_dict:
            cache: mtr
            key: data_dict
            name: Example Data 1
            element: generic_table
            link: "/example/%(_key)s"
            fields:
              - "First": first
              - "Second": second
            no_max_height: True

        table_list:
          # Payload output key
          table_data_list:
            cache: mtr
            key: mtr
            name: Hop
            element: generic_table
            link: "/example/%(target)s"
            link_field: index
            fields:
              - "First": ip
              - "Loss": loss
              - "Sent": sent
              - "Last": last
              - "Avg": average
              - "Best": best
              - "Worst": worst
              - "StdDev": stddev
            no_max_height: True


# Site NavBar and User links.  Overlays over the `root`.
nav:
  bar:
    Home: /
    Info: /info
    Work: /work
    Status: /status
    Problems: /problem
  
  user:
    Status: /status
    Progress: /progress
    Work: /work
    Settings: /settings
    Sign Out: /signout

